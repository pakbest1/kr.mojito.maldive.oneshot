<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title> Messaging - WebSocket </title>
<style>
body, input, button { background-color: #666; }
</style>
</head>
<body>

<ul>
	<li><a href="./index.html?userid=1001" target="_blank">talk userid: 1001</a></li>
	<li><a href="./index.html?userid=1002" target="_blank">talk userid: 1002</a></li>
	<li><a href="./index.html?userid=1003" target="_blank">talk userid: 1003</a></li>
	<li><a href="./index.html?userid=1004" target="_blank">talk userid: 1004</a></li>
	<li><a href="./index.html?userid=1005" target="_blank">talk userid: 1005</a></li>
</ul>

<div id="talktalk"></div>
<form name="talkform" onsubmit="return false;">
	<input type="hidden" name="channel" />
	<input type="hidden" name="userid"  />
	<input type="text"   name="message" />

	<button> Send </button>
</form>


<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="/assets/js/jquery.mojito.js"></script>
<script src="./jquery.plugin.talk.js"></script>
<script type="text/javascript">
$.talk({
	url      : '/talk/socket',
	parameter: $.getParameterFromSearch(),
	form     : document.querySelector('form[name=talkform]'),

	init     : (e)=>{
		console.log('$talk.init() [form: '+ e.target.name +']');
		let f = e.target, $f = $(f), po = e.parameter;
		if (f && f.channel /*&& po && po.channel*/) { f.channel.value = po.channel || 'lounge'; }
		if (f && f.userid  /*&& po && po.userid */) { f.userid .value = po.userid  || '1000'  ; }
		if (f && f.message /*&& po && po.message*/) { f.message.value = po.message || ''      ; }

		$(f.message).focus();
	},
	recive   : (e)=>{
		console.log('[recive:'+ e.data +']');
		if (!e.data) { return; }
	},

	send     : (e)=>{
		console.log('[send:'  + e.data +']');
		let f = e.target, $f = $(f)

		//let s = new TalkMessage( $f.serialize() );
		$.talk.send( $f.serialize() );

		//f.message.value = '';
		//f.message.focus();
		$(f.message).val('').focus();

		e.preventDefault();
		return false;
	},
});
</script>
</body>
</html>